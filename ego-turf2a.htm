<html>
<head>
 <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
   integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
   crossorigin=""/>
 <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
    <script src="https://npmcdn.com/@turf/turf@6.3.0/turf.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" 
    crossorigin="anonymous"></script>
    <script src="../src/L.TileLayer.Zoomify.js"></script>
   <style>
#map {
  height: 500px;
}

.leaflet-top .leaflet-control {
    margin-top: 400;
}

.leaflet-control-attribution    {
    display:none;
}
   </style>

</head>
<body>
<div id="map"></div>
</body>
   <script>


L.CursorHandler = L.Handler.extend({

addHooks: function () {
    this._popup = new L.Popup();
    this._map.on('mouseover', this._open, this);
    this._map.on('mousemove', this._update, this);
    this._map.on('mouseout', this._close, this);
},

removeHooks: function () {
    this._map.off('mouseover', this._open, this);
    this._map.off('mousemove', this._update, this);
    this._map.off('mouseout', this._close, this);
},

_open: function (e) {
    this._update(e);
    this._popup.openOn(this._map);
},

_close: function () {
    this._map.closePopup(this._popup);
},

_update: function (e) {
    this._popup.setLatLng(e.latlng)
        .setContent(e.latlng.toString());
}


});

L.Map.addInitHook('addHandler', 'cursor', L.CursorHandler);

/*var map = L.tileLayer.zoomify('img/senna/{g}/{z}-{x}-{y}.jpg',  {
    width: 1920,
    height: 1080,
    cursor: true
});*/

var map = L.map("map", ({ scrollWheelZoom: false }), {
    cursor: true
}).setView([51.995820925789836, -1.5818595886230467], 15);
L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png').addTo(map);


//Wait until the map resources are ready.
/*map.events.addLayer('ready', function () {

//Create an image layer and add it to the map.
map.addLayer(new atlas.layer.ImageLayer({
    url: 'https://media.evo.co.uk/image/private/s--6NS0UECY--/v1587655846/evo/2020/04/McLaren%20P1%20GTR-18%20by%20Lanzante-15.jpg',
    coordinates: [
        [-1.608896, 52.002353], //Top Left Corner
        [-1.554795, 52.002353], //Top Right Corner
        [-1.554795, 51.989325], //Bottom Right Corner
        [-1.608896, 51.989325]  //Bottom Left Corner
    ]
}));
});

/*map.layers.add(new atlas.layer.ImageLayer({
    url: 'img/senna.jpg',
    coordinates: [
        [-1.608896, 52.002353], //Top Left Corner
        [-1.554795, 52.002353], //Top Right Corner
        [-1.554795, 51.989325], //Bottom Right Corner
        [-1.608896, 51.989325]  //Bottom Left Corner
    ]
})).addTo(map);*/

var imageUrl = 'img/senna.jpg',
    imageBounds = [[52.002353, -1.608896], [51.989325 ,-1.554795]];

	var overLay=L.imageOverlay(imageUrl, imageBounds);
	map.addLayer(overLay);
    map.fitBounds(imageBounds);

    /*var currentZoom = document.getElementById("currentZoom");

function showZoom() {
  currentZoom.innerHTML = map.getZoom();
}
showZoom();

map.on("zoomend", showZoom);*/
    
    function highlightFeature(e) {
        var layer = e.target;

    layer.setStyle({
        weight: 2,
        color: 'red',
        fillOpacity: 0.4
    });

    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
    }
};

var i = 0;
var c = 0;
var r = 0;
var features = [];
var fixedtllng = -1.608896;
var tllng = fixedtllng;
var tolat = 52.002353;
var fixedtrlng = -1.608381;
var trlng = fixedtrlng;
var bolat = 52.001980;
var latgap = tolat - bolat;
var lnggap = trlng - tllng;

while (r <= 34){
    temp = 
        {
                "type": "Feature",
                "properties": {},
                "geometry": {
                    "type": "Polygon",
                    "coordinates": [
                        [
                            [tllng,tolat],
                            [trlng,tolat],
                            [trlng,bolat],
                            [tllng,bolat],
                            [tllng,tolat]
                        ]
                    ]
                }
            }
    features.push(temp);
    tllng = trlng;
    trlng += lnggap;
    c++;
    i++;
    if (c == 105){
        c = 0;
        r++;
        trlng = fixedtrlng;
        tllng = fixedtllng;
        tolat = bolat;
        bolat -= latgap;
    }
}

    var geojson = {
        "type": "FeatureCollection",
        "features": features
    };



function resetHighlight(e) {
    var layer = e.target;

    layer.setStyle({
        weight: 2,
        color: 'grey',
        fillOpacity: 0.1
})
};

/*var imageUrl = 'https://images.unsplash.com/photo-1608397717231-4a2883be7ad2?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&ixlib=rb-1.2.1&auto=format&fit=crop&w=1330&q=80',
    imageBounds = [[-1.608896, 52.002353], [-1.554795, 51.989325]];

L.imageOverlay(imageUrl, imageBounds, {
    opacity: 1,
    interactive: true
}).addTo(map);


/*function popup(e)  {
    var layer = e.target;

    layer.popup({

    })
}*/

    L.geoJSON(geojson, {
        style: function(feature)    {
            return  {
                color: 'grey',
                weight: 2,
                fillOpacity: 0.1 
            }
        },
            onEachFeature: function(feature, layer) {
                layer.on({
                    mouseover: highlightFeature,
                    mouseout: resetHighlight,
        });
        layer.on('mouseover', function(e) {
  //open popup;
  var popup = L.popup()
   .setLatLng(e.latlng) 
   .setContent('Popup')
   .openOn(map);
});
        },
    }).addTo(map);

    var popup = L.popup();

function onMapClick(e) {
    popup
        .setLatLng(e.latlng)
        .setContent("You clicked the map at " + e.latlng.toString())
        .openOn(map);
}

map.on('click', onMapClick);




/*if(feature.geometry.type==='Polygon')   {
layer.bindPopup(feature.geometry.coordinates.join(','));*/


</script>
</html>
